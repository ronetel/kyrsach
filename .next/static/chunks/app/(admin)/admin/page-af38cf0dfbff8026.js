(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5867],{35695:(e,r,t)=>{"use strict";var a=t(18999);t.o(a,"redirect")&&t.d(r,{redirect:function(){return a.redirect}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},37101:(e,r,t)=>{"use strict";t.d(r,{default:()=>g});var a=t(95155),s=t(12115),d=t(12108),i=t(35695),n=t(13568),c=t(6874),o=t.n(c);let l=e=>{let{orders:r,onUpdateOrderStatus:t}=e;return(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Управление заказами"}),0===r.length?(0,a.jsx)("p",{children:"Заказы отсутствуют."}):(0,a.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,a.jsx)("div",{className:"bg-[#3A2B2B] p-4 rounded-lg shadow-lg",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-lg font-semibold",children:["Заказ #",e.id]}),(0,a.jsxs)("p",{children:["Дата: ",e.date]}),(0,a.jsxs)("p",{children:["Адрес: ",e.address]}),(0,a.jsxs)("p",{children:["Клиент: ",e.user.Name_user," (",e.user.Email_user,")"]}),(0,a.jsxs)("p",{children:["Сумма: ",e.total," ₽"]})]}),(0,a.jsxs)("select",{value:e.status,onChange:r=>t(e.id,r.target.value),className:"p-2 bg-[#4A3B3B] text-white rounded h-12 text-md",children:[(0,a.jsx)("option",{value:"PENDING",children:"В ожидании"}),(0,a.jsx)("option",{value:"SUCCEEDED",children:"Выполнен"}),(0,a.jsx)("option",{value:"CANCELLED",children:"Отменён"})]})]})},e.id))})]})};var u=t(60714),h=t(56053);let g=()=>{let{data:e,status:r}=(0,d.useSession)(),t=(0,i.useRouter)(),{products:c,orders:g,loading:p,fetchAdminData:v,updateOrderStatus:x,deleteProduct:m}=(0,h.g)();(0,s.useEffect)(()=>{if("loading"!==r){if(!e||"Admin"!==e.user.role){t.push("/"),n.Ay.error("Доступ запрещён",{icon:"❌"});return}v()}},[e,r,t,v]);let b=async()=>{await (0,d.signOut)({callbackUrl:"/"})};return"loading"===r||p?(0,a.jsx)("div",{className:"text-white text-center mt-10",children:"Загрузка..."}):(0,a.jsxs)("div",{className:"min-h-screen bg-main text-white p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Панель администратора"}),(0,a.jsx)(u.$,{variant:"red",onClick:b,children:"Выйти"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(o(),{href:"/admin/add-product",children:(0,a.jsx)(u.$,{variant:"red",children:"Добавить товар"})})}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Список товаров"}),0===c.length?(0,a.jsx)("p",{children:"Товары отсутствуют."}):(0,a.jsx)("div",{className:"space-y-4",children:c.map(e=>{var r;return(0,a.jsxs)("div",{className:"bg-[#3A2B2B] p-4 rounded-lg shadow-lg flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-semibold",children:e.name}),(0,a.jsxs)("p",{children:["Категория:"," ",(null==(r=e.Category)?void 0:r.Name_categry)||"Без категории"]})]}),(0,a.jsx)("div",{children:(0,a.jsx)(u.$,{onClick:()=>m(e.ID_Product),variant:"red",children:"Удалить"})})]},e.ID_Product)})})]}),(0,a.jsx)("section",{className:"mt-10",children:(0,a.jsx)(l,{orders:g,onUpdateOrderStatus:x})})]})}},42390:(e,r,t)=>{"use strict";t.d(r,{j:()=>k});var a={};t.r(a),t.d(a,{addCartItem:()=>g,getCart:()=>l,removeCartItem:()=>h,updateItemQuantity:()=>u});var s={};t.r(s),t.d(s,{getMe:()=>p});var d={};t.r(d),t.d(d,{search:()=>x});var i={};t.r(i),t.d(i,{addProduct:()=>N,deleteProduct:()=>w,getCategories:()=>m,getOrders:()=>f,getProducts:()=>y,getSizes:()=>b,updateOrderStatus:()=>j});var n=t(23464),c=t(87358);let o=n.A.create({baseURL:c.env.NEXT_PUBLIC_API_URL}),l=async()=>(await o.get("/api/carts")).data,u=async(e,r)=>(await o.patch("/api/carts/"+e,{quantity:r})).data,h=async e=>(await o.delete("/api/carts/"+e)).data,g=async e=>(await o.post("/api/carts",e)).data,p=async()=>{let{data:e}=await o.get("api/auth/me");return e};var v=function(e){return e.SEARCH_PRODUCTS="api/products/search",e}({});let x=async e=>(await o.get(v.SEARCH_PRODUCTS,{params:{query:e}})).data,m=async()=>(await o.get("/api/categories")).data,b=async()=>(await o.get("/api/sizes")).data,y=async()=>(await o.get("/api/products")).data,f=async()=>(await o.get("/api/orders")).data,j=async(e,r)=>(await o.patch("/api/admin/orders/".concat(e,"/status"),r)).data,w=async e=>{await o.delete("/api/products/".concat(e))},N=async e=>(await o.post("/api/products",e)).data,k={cart:a,auth:s,products:d,admin:i}},46457:(e,r,t)=>{"use strict";t.d(r,{cn:()=>d});var a=t(52596),s=t(39688);function d(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.QP)((0,a.$)(r))}},56053:(e,r,t)=>{"use strict";t.d(r,{g:()=>i});var a=t(65453),s=t(13568),d=t(42390);let i=(0,a.v)((e,r)=>({categories:[],sizes:[],products:[],orders:[],loading:!0,error:!1,fetchAdminData:async()=>{try{e({loading:!0,error:!1});let[r,t,a,s]=await Promise.all([d.j.admin.getCategories(),d.j.admin.getSizes(),d.j.admin.getProducts(),d.j.admin.getOrders()]);e({categories:r,sizes:t,products:a,orders:s})}catch(r){console.error("Fetch admin data error:",r),e({error:!0}),s.Ay.error("Ошибка загрузки данных",{icon:"❌"})}finally{e({loading:!1})}},updateOrderStatus:async(r,t)=>{try{e({loading:!0,error:!1}),await d.j.admin.updateOrderStatus(r,{status:t}),e(e=>({orders:e.orders.map(e=>e.id===r?{...e,status:t}:e)})),s.Ay.success("Статус заказа обновлён",{icon:"✅"})}catch(r){console.error("Update order status error:",r),e({error:!0}),s.Ay.error("Не удалось обновить статус",{icon:"❌"})}finally{e({loading:!1})}},deleteProduct:async r=>{try{e({loading:!0,error:!1}),await d.j.admin.deleteProduct(r),e(e=>({products:e.products.filter(e=>e.ID_Product!==r)})),s.Ay.success("Товар удалён",{icon:"✅"})}catch(r){console.error("Delete product error:",r),e({error:!0}),s.Ay.error("Не удалось удалить товар",{icon:"❌"})}finally{e({loading:!1})}},addProduct:async r=>{try{e({loading:!0,error:!1});let t=await d.j.admin.addProduct(r);e(e=>({products:[t,...e.products]})),s.Ay.success("Товар добавлен",{icon:"✅"})}catch(r){console.error("Add product error:",r),e({error:!0}),s.Ay.error("Не удалось добавить товар",{icon:"❌"})}finally{e({loading:!1})}}}))},60714:(e,r,t)=>{"use strict";t.d(r,{$:()=>o});var a=t(95155),s=t(12115),d=t(99708),i=t(74466),n=t(46457);let c=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-dop-bg text-black shadow-xs hover:bg-dop-bg/90 rounded-2xl",red:"bg-mint-500 shadow-xs hover:bg-mint-500/90 rounded-3xl",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}}),o=s.forwardRef((e,r)=>{let{className:t,variant:s,size:i,asChild:o=!1,loading:l,children:u,...h}=e,g=o?d.Slot:"button";return(0,a.jsx)(g,{"data-slot":"button",className:(0,n.cn)(c({variant:s,size:i,className:t}),l&&"opacity-75 pointer-events-none"),disabled:!!l,"aria-busy":!!l,ref:r,...h,children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),u]}):u})});o.displayName="Button"},98615:(e,r,t)=>{Promise.resolve().then(t.bind(t,37101))}},e=>{var r=r=>e(e.s=r);e.O(0,[9352,3568,5604,3892,6874,2108,8441,1684,7358],()=>r(98615)),_N_E=e.O()}]);