(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1378],{22798:(e,s,t)=>{"use strict";t.d(s,{m:()=>i});var r=t(95155),a=t(46457);t(12115);let i=e=>{let{className:s,children:t}=e;return(0,r.jsx)("div",{className:(0,a.cn)("mx-auto max-w-[1280px]",s),children:t})}},25240:(e,s,t)=>{"use strict";t.d(s,{ProfileForm:()=>h});var r=t(95155),a=t(90221),i=t(12115),n=t(62177),l=t(13568),d=t(12108),o=t(22798),c=t(59877),u=t(45094),m=t(60714),x=t(34477);let p=(0,x.createServerReference)("404665926b0eb47faa88578dc649392ddf51f09e1d",x.callServer,void 0,x.findSourceMapURL,"updateUserInfo");var v=t(55594);let f=()=>{let[e,s]=(0,i.useState)([]),[t,a]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(async()=>{try{a(!0);let e=await fetch("/api/orders");if(!e.ok)throw Error("Не удалось загрузить историю заказов");let t=await e.json();s(t)}finally{a(!1)}})()},[]);let n=e=>{switch(e){case"PENDING":return"В обработке";case"SUCCEEDED":return"Выполнен";case"CANCELLED":return"Отменен";default:return e}};return t?(0,r.jsx)("div",{className:"text-center py-8",children:"Загрузка истории заказов..."}):0===e.length?(0,r.jsx)("div",{className:"text-center py-8 text-dop-bg",children:"Заказов еще не было"}):(0,r.jsx)("div",{className:"space-y-6",children:e.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-4 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-semibold",children:["Заказ #",e.id]}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:e.date}),(0,r.jsx)("p",{className:"text-sm mt-1",children:e.address})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end",children:[(0,r.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("SUCCEEDED"===e.status?"bg-dop-bg text-green-800":"CANCELLED"===e.status?"bg-dop-bg text-red-800":"bg-dop-bg text-yellow-800"),children:n(e.status)}),e.points>0&&(0,r.jsxs)("span",{className:"mt-1 text-xs text-mint-500",children:["+",e.points," баллов"]})]})]}),(0,r.jsx)("div",{className:"mt-4 space-y-3",children:e.items.map(e=>(0,r.jsx)("div",{className:"flex gap-3",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("p",{className:"font-medium",children:e.productItem.Product.name}),(0,r.jsxs)("p",{className:"font-medium",children:[e.quantity*e.productItem.Price," ₽"]})]}),e.productItem.Size&&(0,r.jsxs)("p",{className:"text-sm text-gray-400",children:["Размер: ",e.productItem.Size.Size_name]}),(0,r.jsxs)("p",{className:"text-sm text-gray-400",children:[e.quantity," \xd7 ",e.productItem.Price," ₽"]})]})},e.id))}),(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t flex justify-between font-bold",children:[(0,r.jsx)("span",{children:"Итого:"}),(0,r.jsxs)("span",{children:[e.total," ₽"]})]})]},e.id))})},b=v.z.object({fullName:v.z.string().min(2,{message:"Введите имя и фамилию"}),email:v.z.string().email({message:"Введите корректную почту"}),password:v.z.string().min(4,{message:"Введите корректный пароль"}).optional().or(v.z.literal("")),confirmPassword:v.z.string().optional().or(v.z.literal(""))}).refine(e=>!e.password&&!e.confirmPassword||e.password===e.confirmPassword,{message:"Пароли не совпадают",path:["confirmPassword"]}),h=e=>{let{data:s}=e,t=(0,n.mN)({resolver:(0,a.u)(b),defaultValues:{fullName:s.Name_user,email:s.Email_user,password:"",confirmPassword:""}}),i=async e=>{try{let s={Email_user:e.email,Name_user:e.fullName};e.password&&(s.Password_user=e.password),await p(s),l.Ay.success("Данные обновлены \uD83D\uDCDD",{icon:"✅"})}catch(e){l.Ay.error("Ошибка при обновлении данных",{icon:"❌"})}};return(0,r.jsx)(o.m,{className:"my-10",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(c.y,{text:"Личные данные",size:"md",className:"font-bold"}),(0,r.jsx)(n.Op,{...t,children:(0,r.jsxs)("form",{className:"flex flex-col gap-5 w-96 mt-10",onSubmit:t.handleSubmit(i),children:[(0,r.jsx)(u.Z,{name:"email",label:"E-Mail",required:!0}),(0,r.jsx)(u.Z,{name:"fullName",label:"Полное имя",required:!0}),(0,r.jsx)(u.Z,{type:"password",name:"password",label:"Новый пароль"}),(0,r.jsx)(u.Z,{type:"password",name:"confirmPassword",label:"Повторите пароль"}),(0,r.jsx)(m.$,{disabled:t.formState.isSubmitting,className:"text-base mt-10",type:"submit",children:"Сохранить"}),(0,r.jsx)(m.$,{onClick:()=>{(0,d.signOut)({callbackUrl:"/"})},variant:"secondary",disabled:t.formState.isSubmitting,className:"text-base",type:"button",children:"Выйти"})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(c.y,{text:"История заказов",size:"md",className:"font-bold mb-6"}),(0,r.jsx)(f,{})]})]})})}},30967:(e,s,t)=>{Promise.resolve().then(t.bind(t,25240))},34477:(e,s,t)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),!function(e,s){for(var t in s)Object.defineProperty(e,t,{enumerable:!0,get:s[t]})}(s,{callServer:function(){return r.callServer},createServerReference:function(){return i},findSourceMapURL:function(){return a.findSourceMapURL}});let r=t(53806),a=t(31818),i=t(34979).createServerReference},39029:(e,s,t)=>{"use strict";t.d(s,{k:()=>n});var r=t(95155),a=t(54416);t(12115);var i=t(46457);let n=e=>{let{onClick:s,className:t}=e;return(0,r.jsx)("button",{onClick:s,className:(0,i.cn)("absolute right-4 top-1/2 -translate-y-1/2 opacity-30 hover:opacity-100 cursor-pointer",t),children:(0,r.jsx)(a.A,{className:"h-5 w-5"})})}},45094:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r.Z,h:()=>o});var r=t(83286),a=t(95155);t(12115);var i=t(62177),n=t(46457);function l(e){let{className:s,...t}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,n.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...t})}var d=t(39029);let o=e=>{var s;let{className:t,name:r,label:n,required:o,...c}=e,{register:u,formState:{errors:m},watch:x,setValue:p}=(0,i.xW)(),v=x(r),f=null==(s=m[r])?void 0:s.message;return(0,a.jsxs)("div",{className:t,children:[(0,a.jsxs)("p",{className:"font-medium mb-2",children:[n," ",o&&(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(l,{className:"h-12 text-md",...u(r),...c}),v&&(0,a.jsx)(d.k,{onClick:()=>{p(r,"")}})]}),f&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-2",children:f})]})}},46457:(e,s,t)=>{"use strict";t.d(s,{cn:()=>i});var r=t(52596),a=t(39688);function i(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.QP)((0,r.$)(s))}},59877:(e,s,t)=>{"use strict";t.d(s,{y:()=>i});var r=t(52596),a=t(12115);let i=e=>{let{text:s,size:t="sm",className:i}=e;return a.createElement({xs:"h5",sm:"h4",md:"h3",lg:"h2",xl:"h1","2xl":"h1"}[t],{className:(0,r.A)({xs:"text-[16px]",sm:"text-[22px]",md:"text-[26px]",lg:"text-[32px]",xl:"text-[40px]","2xl":"text-[48px]"}[t],i)},s)}},60714:(e,s,t)=>{"use strict";t.d(s,{$:()=>o});var r=t(95155),a=t(12115),i=t(99708),n=t(74466),l=t(46457);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-dop-bg text-black shadow-xs hover:bg-dop-bg/90 rounded-2xl",red:"bg-mint-500 shadow-xs hover:bg-mint-500/90 rounded-3xl",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef((e,s)=>{let{className:t,variant:a,size:n,asChild:o=!1,loading:c,children:u,...m}=e,x=o?i.Slot:"button";return(0,r.jsx)(x,{"data-slot":"button",className:(0,l.cn)(d({variant:a,size:n,className:t}),c&&"opacity-75 pointer-events-none"),disabled:!!c,"aria-busy":!!c,ref:s,...m,children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),u]}):u})});o.displayName="Button"},83286:(e,s,t)=>{"use strict";t.d(s,{Z:()=>c});var r=t(95155),a=t(62177);t(12115);var i=t(46457);function n(e){let{className:s,type:t,...a}=e;return(0,r.jsx)("input",{type:t,"data-slot":"input",className:(0,i.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...a})}var l=t(91155),d=t(83463),o=t(39029);let c=e=>{var s;let{className:t,name:i,label:c,required:u,...m}=e,{register:x,formState:{errors:p},watch:v,setValue:f}=(0,a.xW)(),b=v(i),h=null==(s=p[i])?void 0:s.message;return(0,r.jsxs)("div",{className:t,children:[c&&(0,r.jsxs)("p",{className:"font-medium mb-2",children:[c," ",u&&(0,r.jsx)(d.Y,{})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(n,{className:"h-12 text-md",...x(i),...m}),b&&(0,r.jsx)(o.k,{onClick:()=>{f(i,"",{shouldValidate:!0})}})]}),h&&(0,r.jsx)(l.y,{text:h,className:"mt-2"})]})}},83463:(e,s,t)=>{"use strict";t.d(s,{Y:()=>a});var r=t(95155);t(12115);let a=()=>(0,r.jsx)("span",{className:"text-red-500",children:"*"})},91155:(e,s,t)=>{"use strict";t.d(s,{y:()=>i});var r=t(95155);t(12115);var a=t(46457);let i=e=>{let{text:s,className:t}=e;return(0,r.jsx)("p",{className:(0,a.cn)("text-red-500 text-sm",t),children:s})}}},e=>{var s=s=>e(e.s=s);e.O(0,[9352,3568,3892,2108,7707,8441,1684,7358],()=>s(30967)),_N_E=e.O()}]);