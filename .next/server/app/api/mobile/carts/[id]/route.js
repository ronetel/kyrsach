(()=>{var e={};e.id=206,e.ids=[206],e.modules={505:(e,t,r)=>{"use strict";r.d(t,{n:()=>a});var s=r(43205),i=r.n(s);let a=e=>{let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return null;let r=t.split(" ")[1];try{return i().verify(r,process.env.JWT_SECRET||"")}catch(e){return null}}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67155:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});var s=r(96330);let i=global.prisma||new s.PrismaClient},68992:(e,t,r)=>{"use strict";r.d(t,{q:()=>a});var s=r(67155);let i=e=>e.productItem.Price*e.quantity,a=async(e,t)=>{if(!e&&!t)throw Error("Either token or userId must be provided");let r=await s.z.carts.findFirst({where:{OR:[...e?[{token:e}]:[],...t?[{userId:t}]:[]]},include:{items:{orderBy:{createdAt:"desc"},include:{productItem:{include:{Product:!0,Size:!0}}}}}});if(!r)throw Error("Cart not found");let a=r.items.reduce((e,t)=>e+i(t),0);return await s.z.carts.update({where:{id:r.id},data:{totalAmount:a},include:{items:{include:{productItem:{include:{Product:!0,Size:!0}}}}}})}},78132:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>m,serverHooks:()=>w,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{DELETE:()=>l,PATCH:()=>p});var i=r(96559),a=r(48088),n=r(37719),u=r(32190),o=r(67155),d=r(68992),c=r(505);async function p(e){try{let t=(0,c.n)(e);if(!t)return u.NextResponse.json({message:"Необходима авторизация"},{status:401});let r=Number(t.id),s=Number(new URL(e.url).pathname.split("/").pop()),i=await e.json(),a=await o.z.cartItems.findUnique({where:{id:Number(s)},include:{cart:!0}});if(!a)return u.NextResponse.json({error:"Cart item not found"},{status:404});if(a.cart.userId!==r)return u.NextResponse.json({error:"У вас нет доступа к этому элементу корзины"},{status:403});await o.z.cartItems.update({where:{id:Number(s)},data:{quantity:i.quantity}});let n=await (0,d.q)(void 0,r);if(!n)return u.NextResponse.json({error:"Failed to update cart"},{status:500});return u.NextResponse.json(n,{status:200})}catch(e){return console.error("[CART_PATCH] Server error",e),u.NextResponse.json({message:"Failed to update cart"},{status:500})}}async function l(e){try{let t=(0,c.n)(e);if(!t)return u.NextResponse.json({message:"Необходима авторизация"},{status:401});let r=Number(t.id),s=Number(new URL(e.url).pathname.split("/").pop()),i=await o.z.cartItems.findFirst({where:{id:Number(s)},include:{cart:!0}});if(!i)return u.NextResponse.json({error:"Cart item not found"},{status:404});if(i.cart.userId!==r)return u.NextResponse.json({error:"У вас нет доступа к этому элементу корзины"},{status:403});await o.z.cartItems.delete({where:{id:Number(s)}});let a=await (0,d.q)(void 0,r);return u.NextResponse.json(a,{status:200})}catch(e){return console.error("[CART_DELETE] Server error",e),u.NextResponse.json({message:"Failed to delete cart item"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/mobile/carts/[id]/route",pathname:"/api/mobile/carts/[id]",filename:"route",bundlePath:"app/api/mobile/carts/[id]/route"},resolvedPagePath:"C:\\Users\\ronetel\\Desktop\\eyrs\\kyrsach\\app\\api\\mobile\\carts\\[id]\\route.tsx",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:f,serverHooks:w}=m;function h(){return(0,n.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:f})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[243,580,205],()=>r(78132));module.exports=s})();